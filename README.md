# zbx_prn_rpt

Была поставлена задача получать отчет в excel по счетчикам печати из Zabbix.
Выбор пал на python. Программа формирует отчет в excel по счетчикам печати принтеров из групп хостов _Printers и _Printers_Brother.

Надо выбирать имена хостов вида 0000-P00.

У принтеров Kyocera  Модель хранится за ключом model.device, Всего напечатано страниц - a4.device, Серийный номер - sn.device а у принтеров Brother Серийный номер - mib-2.43.5.1.1.17.1, Всего напечатано страниц - mib-2.43.10.2.1.4.1.1, Модель в шаблоне не определялась, поэтому вместо модели в табличке указываем Brother. 

Дополнительно в отчет включаюися имя хоста и IP адрес. Отчет сортируем по имени хоста. 
Исторически так сложилось, что в нашем забиксе все киосеры находятся в группе _Printers, а все Brother в _Printers_Brother. Это учитываю в программе. Также для упрощения исключаю проверку на сертификаты

# Для подключения к заббиксу использую:

ZABBIX_URL = "https://<URL_Zabbix_server>"

USERNAME = "Admin"

PASSWORD = "PASSWORD"


Перед запуском нужно установить зависимости:

pip install requests openpyxl

# Особенности программы:
# Фильтрация принтеров:

Используется регулярное выражение ^\d{4}-P\d{2}$ для фильтрации имен

Обрабатываются только активные устройства в Zabbix

# Работа с API Zabbix:

Автоматическая аутентификация

Групповой поиск элементов данных для оптимизации запросов

Игнорирование SSL-сертификатов

# Обработка данных:

Для Brother модель устанавливается автоматически

Пропущенные значения заменяются на "N/A"

Автоматическая сортировка по имени хоста

# Расширенная диагностика:

Вывод количества найденных хостов в группах

Проверка соответствия шаблону имени

Контроль получения элементов данных

Проверка наличия обязательных данных (счетчики, серийные номера)

# Обработка ошибок:

Проверка кодов ответа HTTP

Подробные сообщения об ошибках на каждом этапе

Проверка наличия всех требуемых данных

# Формирование Excel-отчета:

Автонастройка ширины столбцов

Жирные заголовки

Колонка с отображаемым именем

Вывод технического имени (по которому проводилась фильтрация)



